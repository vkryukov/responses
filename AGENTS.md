# Repository Guidelines

## Project Structure & Module Organization
- Source: `lib/` — main API in `lib/responses.ex` (`Responses`) with supporting modules in `lib/responses/*.ex` (`Responses.{Response,Stream,Schema,Pricing}`).
- Tests: `test/` — ExUnit suites like `test/responses_test.exs` and `test/responses/*.exs`.
- Docs: `doc/` (generated by `mix docs`), plus extras `README.md`, `CHANGELOG.md`, `tutorial.livemd`.
- Build artifacts and deps: `_build/`, `deps/`. Tooling: `.formatter.exs`, `mise.toml` (Elixir/Erlang versions).

## Build, Test, and Development Commands
- `mix test` — run tests (default excludes `:api`). Example: `mix test --include api` to run live API tests.
- `mix format` — format code; verify with `mix format --check-formatted`.
- `mix credo --strict` — lint for style and consistency.
- `mix dialyzer` — static analysis; fix specs/types before PR.
- `mix docs` — generate HTML docs in `doc/`.
- `iex -S mix` — interactive shell for local exploration.

## Coding Style & Naming Conventions
- Elixir 1.18 / OTP 27 (see `mise.toml`). 2‑space indentation.
- Modules: `Responses.*` (e.g., `lib/responses/stream.ex` -> `Responses.Stream`).
- Functions/variables: `snake_case`; module names: `PascalCase`.
- Always run the formatter; keep functions small, pattern‑match inputs, prefer `with` for flow.

## Testing Guidelines
- Framework: ExUnit; files end with `*_test.exs` and modules `...*Test`.
- Network‑dependent tests must be tagged `@tag :api` (excluded by default via `ExUnit.start(exclude: [:api])`).
- Cover public APIs and edge cases; avoid hitting external services in unit tests.

## Commit & Pull Request Guidelines
- Commits: short, imperative summaries (e.g., “Support automatic wrapping…”, “Fix dialyzer issues”, “Release 0.7.0”).
- PRs include: clear description/rationale, linked issues, tests for changes, formatted code, no Credo warnings, and docs updates when needed.
- Changelog: always add new entries at the top of `CHANGELOG.md` (latest version first, Keep a Changelog style).
- Usage rules: on every release/version bump, update `usage-rules.md` to reflect new/changed public APIs, deprecations, behavior changes, and update the dependency snippet to the released version. Ensure examples match current behavior.

## Security & Configuration Tips
- Never commit secrets. Configure provider API keys via `OPENAI_API_KEY` / `XAI_API_KEY` or configuration (`config :responses, :openai_api_key` / `:xai_api_key`).
- Do not store keys in tests or docs; gate live calls behind the `:api` tag.
